                                                <!DOCTYPE html>
                                                <html lang="en">
                                                <head>
                                                    <meta charset="UTF-8">
                                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                                    <title>Admin Dashboard</title>
                                                    <!-- Tailwind CSS CDN -->
                                                    <script src="https://cdn.tailwindcss.com"></script>
                                                </head>
                                                <body class="bg-gray-100 min-h-screen">

                                                    <!-- Admin Navigation Bar -->
                                                    <nav class="bg-white shadow-md">
                                                        <div class="container mx-auto px-4 max-w-7xl">
                                                            <div class="flex justify-between items-center h-16">
                                                                <!-- Logo/Title -->
                                                                <div class="flex-shrink-0 flex items-center">
                                                                    <h1 class="text-xl font-bold text-gray-900">Diamond CMS</h1>
                                                                </div>
                                                                <!-- Navigation Links -->
                                                                <div class="hidden md:flex md:space-x-8">
                                                                    <a href="/admin" class="text-blue-600 border-b-2 border-blue-600 font-medium px-1 py-4">Dashboard</a>
                                                                    <a href="/admin/manage" class="text-gray-500 hover:text-gray-900 border-b-2 border-transparent hover:border-gray-300 font-medium px-1 py-4">Manage Stones</a>

                                                                    <!-- NEW: Show Users link only if superadmin -->
                                                                    <% if (user.is_superadmin) { %>
                                                                        <a href="/admin/users" class="text-gray-500 hover:text-gray-900 border-b-2 border-transparent hover:border-gray-300 font-medium px-1 py-4">Manage Users</a>
                                                                    <% } %>

                                                                    <a href="/admin/history" class="text-gray-500 hover:text-gray-900 border-b-2 border-transparent hover:border-gray-300 font-medium px-1 py-4">History</a>

                                                                    <!-- NEW: Show Analytics link only if user has permission -->
                                                                    <% if (user.is_superadmin || user.can_view_analytics) { %>
                                                                        <a href="/admin/analytics" class="text-gray-500 hover:text-gray-900 border-b-2 border-transparent hover:border-gray-300 font-medium px-1 py-4">Analytics</a>
                                                                    <% } %>
                                                                </div>
                                                                <!-- User/Logout -->
                                                                <div class="flex items-center">
                                                                    <span class="text-gray-500 mr-4">Welcome, <%= user.username %>!</span>
                                                                    <a href="/logout" class="text-sm text-blue-600 hover:underline">Log Out</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </nav>

                                                    <!-- Page Header -->
                                                    <header class="bg-white shadow-sm">
                                                        <div class="container mx-auto px-4 py-4 max-w-7xl">
                                                            <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
                                                        </div>
                                                    </header>

                                                    <main class="container mx-auto px-4 py-8 max-w-7xl">

                                                        <!-- Status Message -->
                                                        <% if (message) { %>
                                                            <div class="mb-6 p-4 rounded-md <%= message.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                                                                <%= message.text %>
                                                            </div>
                                                        <% } %>

                                                        <!-- 
                                                          NEW: Permission Check
                                                          Only show these forms if the user has permission to add stones
                                                        -->
                                                        <% if (user.is_superadmin || user.can_add) { %>
                                                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                                                                <!-- Column 1: Add Single Stone -->
                                                                <div class="bg-white p-8 rounded-lg shadow-lg">
                                                                    <h3 class="text-2xl font-bold mb-6">Add a Single Stone</h3>
                                                                    <form action="/admin/add-single" method="POST">
                                                                        <div class="mb-4">
                                                                            <label for="stock_id" class="block text-sm font-medium text-gray-700 mb-2">Stock ID (Required, Unique)</label>
                                                                            <input type="text" name="stock_id" id="stock_id" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                                                        </div>
                                                                        <div class="mb-4">
                                                                            <label for="video_url" class="block text-sm font-medium text-gray-700 mb-2">Video URL</label>
                                                                            <input type="url" name="video_url" id="video_url" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://v360.example/view/...">
                                                                        </div>
                                                                        <div class="mb-6">
                                                                            <label for="certificate_url" class="block text-sm font-medium text-gray-700 mb-2">Certificate URL</label>
                                                                            <input type="url" name="certificate_url" id="certificate_url" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://certs.example/...">
                                                                        </div>
                                                                        <div>
                                                                            <button type="submit" class="w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg text-lg transition duration-200">
                                                                                Add Stone
                                                                            </button>
                                                                        </div>
                                                                    </form>
                                                                </div>

                                                                <!-- Column 2: Bulk Upload -->
                                                                <div class="bg-white p-8 rounded-lg shadow-lg">
                                                                    <h3 class="text-2xl font-bold mb-6">Bulk Upload from File</h3>
                                                                    <p class="text-gray-600 mb-4">Upload an Excel (.xlsx) or CSV (.csv) file.</p>
                                                                    <p class="text-sm text-gray-500 mb-6">Note: This uses "INSERT OR IGNORE". It will add new stones and skip any `stock_id` that already exists. It does **not** overwrite.</p>

                                                                    <form action="/admin/upload-bulk" method="POST" enctype="multipart/form-data">
                                                                        <div class="mb-4">
                                                                            <label for="diamondFile" class="block text-sm font-medium text-gray-700 mb-2">Data File (stock_id, video_url, certificate_url)</label>
                                                                            <input type="file" name="diamondFile" id="diamondFile" class="block w-full text-sm text-gray-500
                                                                                file:mr-4 file:py-2 file:px-4
                                                                                file:rounded-full file:border-0
                                                                                file:text-sm file:font-semibold
                                                                                file:bg-blue-50 file:text-blue-700
                                                                                hover:file:bg-blue-100"
                                                                                accept=".xlsx, .xls, .csv" required>
                                                                        </div>
                                                                        <div>
                                                                            <button type="submit" class="w-full py-3 px-6 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg text-lg transition duration-200">
                                                                                Upload Bulk File
                                                                            </button>
                                                                        </div>
                                                                    </form>
                                                                </div>

                                                            </div>
                                                        <% } else { %>
                                                            <!-- Show this if user DOES NOT have 'can_add' permission -->
                                                            <div class="bg-white p-8 rounded-lg shadow-lg text-center">
                                                                <h3 class="text-2xl font-bold mb-4">Welcome, <%= user.username %></h3>
                                                                <p class="text-gray-600">You do not have permissions to add new stones. Please contact a super-admin if you need access.</p>
                                                            </div>
                                                        <% } %>
                                                        <!-- END: Permission Check -->

                                                    </main>

                                                    <!-- 
                                                      NEW: Disclaimer Modal
                                                      This is hidden by default. A script below will show it
                                                      if 'showDisclaimer' is true.
                                                    -->
                                                    <div id="disclaimerModal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                                                        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                                                            <!-- Background overlay -->
                                                            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

                                                            <!-- Modal panel -->
                                                            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                                                            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                                                                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                                                                    <div class="sm:flex sm:items-start">
                                                                        <!-- Icon -->
                                                                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                                                                            <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                                                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                            </svg>
                                                                        </div>
                                                                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                                                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                                                                Disclaimer
                                                                            </h3>
                                                                            <div class="mt-2">
                                                                                <p class="text-sm text-gray-600 mb-3">
                                                                                    This application is provided for testing and educational purposes only.
                                                                                </p>
                                                                                <p class="text-sm text-gray-600">
                                                                                    All data displayed, entered, or generated within this system should be considered DUMMY DATA. No assumptions of real-world accuracy, data privacy, or commercial use should be made.
                                                                                </p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                                                                    <button type="button"
                                                                            onclick="closeDisclaimerModal()"
                                                                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                                                                        I Understand
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- NEW: JavaScript for Modal -->
                                                    <script>
                                                        const disclaimerModal = document.getElementById('disclaimerModal');
                                                        const showDisclaimer = <%= showDisclaimer %>; // This is true or false

                                                        function closeDisclaimerModal() {
                                                            disclaimerModal.classList.add('hidden');
                                                        }

                                                        // Run this when the page loads
                                                        if (showDisclaimer) {
                                                            disclaimerModal.classList.remove('hidden');
                                                        }
                                                    </script>

                                                </body>
                                                </html>